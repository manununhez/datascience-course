---
title: "Template Tarea: Análisis Exploratorio de Datos"
author: ""
date: "12/3/2017"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, echo=FALSE}
library(stringr)
source('utils.R')
becal_completo = read.csv('./data/becal_completo.csv', header = T, stringsAsFactors = F, fileEncoding = "utf-8")
```

```{r, echo=FALSE}
# Se eliminan los registros cuyo tipo de estudio no sean
# maestría o doctorado
becal_completo = subset(becal_completo, !(is.na(tipoestudio)))
```

## Perfil demográfico de los becarios

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r perfil_demografico}
#########################
# Análisis de la distribución de becarios por edad
# Tecnica utilizada: Histograma, boxplot y summary
paste("Cantidad de registros (n=",nrow(becal_completo),")")
#########################

hist(becal_completo$edad, main=paste("Distribución de becarios por edad (n=",nrow(becal_completo),")"),  ylab="Frecuencia", xlab="Edad", col = "red", xlim = c(20, 45)) #limitamos esto en base a los valores min,max de la columna edad

boxplot(becal_completo$edad, col='red', main=paste("Distribución de becarios por edad (n=",nrow(becal_completo),")"), ylab='Edad')

summary(becal_completo$edad)

#########################
# Análisis de la distribución de becarios por sexo
# Tecnica utilizada: table. Contabilizamos la cantidad de registros por categoria (feminino/masculino)
paste("Cantidad de registros (n=",nrow(becal_completo),")")
#########################
table(becal_completo$sexo) #para variables categoricas

#########################
# Análisis de la distribución de becarios por sector laboral
# Tecnica utilizada: table. Contabilizamos la cantidad de registros por categoria (publico/privada)
paste("Cantidad de registros (n=",nrow(becal_completo),")")
#########################
becal_completo$funcionariopublicoinstitucion = str_trim(becal_completo$funcionariopublicoinstitucion)
becal_completo[grep('NO',becal_completo$funcionariopublicoinstitucion),'sectortrabajofuncionario'] = 'privado'
becal_completo[grep('NO',becal_completo$funcionariopublicoinstitucion, invert = TRUE),'sectortrabajofuncionario'] = 'publico' #con invert traemos aquellos registros que no hacen match con la condicion puesta
table(becal_completo$sectortrabajofuncionario) #para variables categoricas


#ciudad y departamento de origen
#ciudad
becal_completo$ciudaddeorigen = limpiar_nombres(becal_completo$ciudaddeorigen)
dis_categoriauni = table(droplevels(as.factor(becal_completo$ciudaddeorigen)))
categoria_ordenadas = head(sort(dis_categoriauni, decreasing = T), 30)  # ordena las categorias de mayor a menor. Solo se muestran los primeros 20 valores
xx = barplot(categoria_ordenadas, ylim = c(0, 1.1* max(categoria_ordenadas)), width = 0.85, main=paste("Becarios por ciudad de origen (n=", nrow(becal_completo),")"), ylab="Total",  col="blue", las = 2, angle = 45)
text(x = xx, y = categoria_ordenadas, label = categoria_ordenadas, pos = 3, cex = 0.8, col = "red") ## Add text at top of bars

#departamento
becal_completo$departamentodeorigen = limpiar_nombres(becal_completo$departamentodeorigen)
dis_categoriauni = table(droplevels(as.factor(becal_completo$departamentodeorigen)))
categoria_ordenadas = sort(dis_categoriauni, decreasing = T)  # ordena las categorias de mayor a menor
xx = barplot(categoria_ordenadas, ylim = c(0, 1.1* max(categoria_ordenadas)), width = 0.85, main=paste("Becarios por departamento de origen (n=", nrow(becal_completo),")"), ylab="Total",  col="blue", las = 2, angle = 45)
text(x = xx, y = categoria_ordenadas, label = categoria_ordenadas, pos = 3, cex = 0.8, col = "red") ## Add text at top of bars


#ciudad y departamento de residencia
#ciudad
becal_completo$ciudadderesidencia = limpiar_nombres(becal_completo$ciudadderesidencia)
dis_categoriauni = table(droplevels(as.factor(becal_completo$ciudadderesidencia)))
categoria_ordenadas = head(sort(dis_categoriauni, decreasing = T), 20)  # ordena las categorias de mayor a menor. Solo se muestran los primeros 20 valores
xx = barplot(categoria_ordenadas, ylim = c(0, 1.1* max(categoria_ordenadas)), width = 0.85, main=paste("Becarios por ciudad de residencia (n=", nrow(becal_completo),")"), ylab="Total",  col="blue", las = 2,  angle = 45)
text(x = xx, y = categoria_ordenadas, label = categoria_ordenadas, pos = 3, cex = 0.8, col = "red") ## Add text at top of bars

#departamento
#becal_sin_na = filter(becal_completo, becal_completo$departamentoderesidencia != 'no corresponde' & becal_completo$departamentoderesidencia != 'no aplica' & becal_completo$departamentoderesidencia != 'sin dato' & becal_completo$departamentoderesidencia != '' )  # elimino los valores ausentes

becal_completo$departamentoderesidencia = limpiar_nombres(becal_completo$departamentoderesidencia)
dis_categoriauni = table(droplevels(as.factor(becal_completo$departamentoderesidencia)))
categoria_ordenadas = sort(dis_categoriauni, decreasing = T)  # ordena las categorias de mayor a menor
#dis_categoriauni = table(droplevels(as.factor(becal_sin_na['departamentoderesidencia'])))
#categoria_ordenadas = sort(dis_categoriauni, decreasing = T)  # ordena las categorias de mayor a menor
xx = barplot(categoria_ordenadas, ylim = c(0, 1.1* max(categoria_ordenadas)), width = 0.85, main=paste("Becarios por departamento de residencia (n=", nrow(becal_completo),")"), ylab="Total",  col="blue", las = 2, angle = 45)
text(x = xx, y = categoria_ordenadas, label = categoria_ordenadas, pos = 3, cex = 0.8, col = "red") ## Add text at top of bars

```

Describir aquí los resultados

####edad

####sexo

####sector laboral (público/privado)

####ciudad y departamento de origen

####ciudad y departamento de residencia

## Tipo de estudios, aréas de la ciencia, y disciplinas

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r tipo_estudio}
# Escribir aquí el código de análisis de la distribución de becas por 
# tipo (maestría/doctorado) y disciplina

paste("Cantidad de registros (n=", nrow(becal_completo),")")

becal_completo$tipodebecasegunprogramaaprobado = limpiar_nombres(becal_completo$tipodebecasegunprogramaaprobado)
dis_categoriauni = table(droplevels(as.factor(becal_completo$tipodebecasegunprogramaaprobado)))
categoria_ordenadas = sort(dis_categoriauni, decreasing = T)  # ordena las categorias de mayor a menor
xx = barplot(categoria_ordenadas, ylim = c(0, 1.1* max(categoria_ordenadas)), width = 0.85, main=paste("Becarios por tipodebecasegunprogramaaprobado (n=", nrow(becal_completo),")"), ylab="Total",  col="blue", las = 2, angle = 45)
text(x = xx, y = categoria_ordenadas, label = categoria_ordenadas, pos = 3, cex = 0.8, col = "red") ## Add text at top of bars

dis_categoriauni = table(droplevels(as.factor(becal_completo$tipoestudio)))
categoria_ordenadas = sort(dis_categoriauni, decreasing = T)  # ordena las categorias de mayor a menor
xx = barplot(categoria_ordenadas, ylim = c(0, 1.1* max(categoria_ordenadas)), width = 0.85, main=paste("Becarios por tipodebecasegunprogramaaprobado (n=", nrow(becal_completo),")"), ylab="Total",  col="blue", angle = 45)
text(x = xx, y = categoria_ordenadas, label = categoria_ordenadas, pos = 3, cex = 0.8, col = "red") ## Add text at top of bars
```

Describir aquí los resultados

### Duración de estudios

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r duracion_estudio}
# Escribir aquí el código de análisis para calcular el promedio, la mediana, el mínimo, 
# máximo, desviación estándar, y los cuantiles (0.25, 0.75) del tiempo de duración de 
# los estudios

#Preprocesamiento
becal_completo$mesesdeduraciondeestudios = as.numeric(becal_completo$mesesdeduraciondeestudios)
becal_meses_duracion_limpio = subset(becal_completo, becal_completo$mesesdeduraciondeestudios > 0) #limpiamos los meses con duracion 0 y los NA

paste("Cantidad de registros (n=", nrow(becal_meses_duracion_limpio),")")

summary(becal_meses_duracion_limpio$mesesdeduraciondeestudios)
sd(becal_meses_duracion_limpio$mesesdeduraciondeestudios)
quantile(becal_meses_duracion_limpio$mesesdeduraciondeestudios, probs = c(0.25, 0.75, 1))


```

Describir aquí los resultados

### Completitud de estudios

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r completitud_estudio}
# Escribir aquí el código de análisis para calcular los cuantiles (25%, 50%, 75%, 100%) 
# de completitud  de los estudios


becal_completo$mesesdeduraciondeestudios = as.numeric(becal_completo$mesesdeduraciondeestudios)
becal_meses_duracion_limpio = subset(becal_completo, becal_completo$mesesdeduraciondeestudios > 0) #limpiamos los meses con duracion 0 y los NA
becal_meses_duracion_limpio = becal_meses_duracion_limpio[grep('-',becal_meses_duracion_limpio$iniciocoberturadebeca, invert = TRUE),] #eliminamos aquellos registros con iniciocobertura con formato <fecha>-<fecha>-<fecha>
becal_meses_duracion_limpio = becal_meses_duracion_limpio[grep('Y',becal_meses_duracion_limpio$iniciocoberturadebeca, invert = TRUE),] #eliminamos aquellos registros con iniciocobertura con formato <fecha> Y <fecha>
#???paste("Cantidad de registros (n=", nrow(becal_meses_duracion_limpio),")")

completitud_t = function(inicio, duracion) {
  hoy = Sys.Date()
  duracion = as.numeric(duracion)
  inicio = as.Date(strptime(inicio, "%m/%d/%Y"))
  aux_fin = seq(inicio, by='months',length.out=duracion)
  fin = aux_fin[length(aux_fin)]
  if (hoy >= fin) {
    return (100)
  } else {
    meses_completados = length(seq(inicio, hoy, by='months'))-1
    porcentaje_faltante = round((meses_completados/duracion)*100,0)
    return (porcentaje_faltante)
  }
}

sapply(becal_meses_duracion_limpio$iniciocoberturadebeca, completitud2, becal_meses_duracion_limpio$mesesdeduraciondeestudios)

```

Describir aquí los resultados

## Países, ciudades, y universidades de destino

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r destino}
# Escribir aquí el código de análisis de la distribución de becas por país, 
# ciudad, y universidad de destino;
becal_completo$paisdedestino = limpiar_nombres(becal_completo$paisdedestino)
dis_pais_destino = table(droplevels(as.factor(becal_completo$paisdedestino)))
categoria_ordenadas = sort(dis_pais_destino, decreasing = T)  # ordena las categorias de mayor a menor
barplot(categoria_ordenadas, main=paste("Becarios por paises (n=",nrow(becal_completo),")"), ylab="Total", col="blue", las = 2)

becal_completo$universidaddedestino = limpiar_nombres(becal_completo$universidaddedestino)
dis_univ_destino = table(droplevels(as.factor(becal_completo$universidaddedestino)))
categoria_ordenadas = sort(dis_univ_destino, decreasing = T)  # ordena las categorias de mayor a menor
barplot(categoria_ordenadas, main=paste("Becarios por universidad (n=",nrow(becal_completo),")"), ylab="Total", col="blue", las = 2)

```

Describir aquí los resultados

### Becarios por rango de ranking de universidad de destino

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r distribucion_ranking}
# Escribir aquí el código de análisis que permita investigar la distribución de 
# becarios por rango de ranking de universidad de destino (top 10, top 50, 
# top 100, top 150, top 200, mayor a 200)
becal_limpio = subset(becal_completo, categoriauni != "sin dato") # elimina los registros "sin dato"
dis_categoriauni = table(droplevels(as.factor(becal_limpio$categoriauni)))
categoria_ordenadas = sort(dis_categoriauni, decreasing = T)  # ordena las categorias de mayor a menor
barplot(categoria_ordenadas, main=paste("Becarios por rango de ranking de universidad (n=",
                                        nrow(becal_limpio),")"), ylab="Total", xlab="Rango de ranking", col="blue")

```

Describir aquí los resultados

## Becas

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r montos_beca}
# Escribir aquí el código de análisis que calcular el promedio, la mediana
# el mínimo, máximo, y desviación estándar de los montos de beca
```

Describir aquí los resultados

### Porcentaje de cobertura

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r cobertura}
# Escribir aquí el código de análisis que calcular los cuantiles 
# (25%, 50%, 75%, 100%) de cobertura
```

Describir aquí los resultados

### Top-10 montos de cobertura

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r top10_montos}
# Escribir aquí el código de análisis que calcular el top-10 de montos de 
# coberturas y el tipo de estudio a que corresponden
```

Describir aquí los resultados

### Correlación entre montos de cobertura y ranking de universidades

Describir aquí el análisis (técnica, cantidad de registros, etc.)

```{r correlacion}
# Escribir aquí el código de análisis que calcular la correlación 
# entre montos de cobertura y ranking de universidades
```

Describir aquí los resultados